<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è - –ê–≤–∞—Ç–∞—Ä</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px; margin: 50px auto; padding: 20px;
      background: #f5f5f5;
    }

    .profile-settings {
      background: white; padding: 30px; border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    h3 { margin-top: 0; color: #333; }

    .drop-zone {
      width: 200px; height: 200px; margin: 20px auto;
      border: 3px dashed #d1d5db; border-radius: 50%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.3s;
      background: #f9fafb; position: relative; overflow: hidden;
    }

    .drop-zone:hover, .drop-zone.dragover {
      border-color: #3b82f6; background: #eff6ff;
      transform: scale(1.02);
    }

    #profileImg {
      width: 100%; height: 100%;
      object-fit: cover; border-radius: 50%;
      display: block;
    }

    .drop-text {
      margin: 0; color: #6b7280; font-size: 14px;
      text-align: center; opacity: 0.7;
    }

    .drop-zone.dragover .drop-text {
      opacity: 0;
    }

    button {
      background: #3b82f6; color: white;
      border: none; padding: 12px 24px;
      border-radius: 8px; cursor: pointer;
      font-size: 16px; font-weight: 500;
      transition: background 0.2s;
      margin-top: 20px;
    }

    button:hover { background: #2563eb; }
    button:disabled { background: #9ca3af; cursor: not-allowed; }

    .status {
      margin-top: 15px; font-size: 14px;
      min-height: 20px;
    }

    .success { color: #10b981; }
    .error { color: #ef4444; }
  </style>
</head>
<body>
  <div class="profile-settings">
    <h3>–ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è</h3>
    <div id="dropZone" class="drop-zone">
      <img id="profileImg" src="https://via.placeholder.com/200/6b7280/ffffff?text=üë§" alt="–ê–≤–∞—Ç–∞—Ä">
      <p class="drop-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ</p>
    </div>
    <button id="saveBtn" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    <div id="status" class="status"></div>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const profileImg = document.getElementById('profileImg');
    const saveBtn = document.getElementById('saveBtn');
    const status = document.getElementById('status');

    let currentFile = null;
    let originalSrc = profileImg.src;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag & drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ drop
    dropZone.addEventListener('drop', handleDrop, false);
    dropZone.addEventListener('click', handleClick);

    function handleDrop(e) {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    }

    // –ö–ª–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    function handleClick() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      };
      input.click();
    }

    function handleFile(file) {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!file.type.startsWith('image/')) {
        showStatus('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!', 'error');
        return;
      }

      if (file.size > 5 * 1024 * 1024) { // 5MB
        showStatus('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (–º–∞–∫—Å. 5MB)', 'error');
        return;
      }

      currentFile = file;
      previewImage(file);
      saveBtn.disabled = false;
      showStatus('–ì–æ—Ç–æ–≤–æ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é', 'success');
    }

    function previewImage(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        profileImg.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∏–º–∏—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞)
    saveBtn.addEventListener('click', () => {
      if (!currentFile) return;

      saveBtn.disabled = true;
      saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è...';
      showStatus('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...', '');

      // –ò–º–∏—Ç–∞—Ü–∏—è AJAX-–∑–∞–ø—Ä–æ—Å–∞
      setTimeout(() => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        const reader = new FileReader();
        reader.onload = (e) => {
          localStorage.setItem('userAvatar', e.target.result);
          showStatus('‚úÖ –ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
          saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
          originalSrc = profileImg.src;

          setTimeout(() => {
            saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            saveBtn.disabled = false;
          }, 2000);
        };
        reader.readAsDataURL(currentFile);
      }, 1500);
    });

    function showStatus(message, type) {
      status.textContent = message;
      status.className = `status ${type}`;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    const savedAvatar = localStorage.getItem('userAvatar');
    if (savedAvatar) {
      profileImg.src = savedAvatar;
    }
  </script>
</body>
</html>
